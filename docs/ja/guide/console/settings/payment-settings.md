# 支払い設定

ここでは、チャージ機能に関連する設定を行うことができます。

![支付设置](../../../assets/guide/payment-setting.png)

![Stripe](../../../assets/guide/stripe.png)

## 対応する決済ゲートウェイ

- **易支付（EPay）**
  - 必須項目：`API アドレス`、`マーチャント ID（PID）`、`マーチャントキー（KEY）`
  - プラットフォームのコールバックパラメータには署名が含まれており、システムが検証を行い、自動的に入金処理を行います。
- **Stripe（オプション）**
  - 必須項目：`API キー` `WebHook 署名キー` `商品価格 ID`

## 易支付とは

`易支付`は、「サードパーティの統合決済ゲートウェイ/インターフェース」モデルの総称であり、特定のウェブサイトや企業を指すものではありません。商用の統合決済サービスを指すこともあれば、自作/オープンソースで「易支付プロトコルスタイル」に準拠したゲートウェイ実装を指すこともあります。

- **核となる機能**: WeChat Pay、Alipay、銀行カードなどのチャネルを統合し、マーチャントに統一された注文、署名検証、およびコールバックインターフェースを提供します。
- **コンプライアンスに関する注意**: ゲートウェイ自体は、ライセンスを持つ決済機関と同じではありません。資金の清算とコンプライアンスは、接続先のライセンスを持つチャネルに依存します。所在地の規制およびリスク管理要件に従ってください。

## チャージ方法の設定テンプレート

「チャージ方法」では、以下の構造で設定できます。

```json
[
  {
    "color": "rgba(var(--semi-blue-5), 1)",
    "name": "支付宝",
    "type": "alipay"
  },
  {
    "color": "rgba(var(--semi-green-5), 1)",
    "name": "微信",
    "type": "wxpay"
  },
  {
    "color": "rgba(var(--semi-green-5), 1)",
    "name": "Stripe",
    "type": "stripe",
    "min_topup": "50"
  },
  {
    "name":      "自定义1",
    "color":     "black",
    "type":      "custom1",
    "min_topup": "50"
   }
]
```

### フィールドの説明

- name: 表示テキスト。「支払い方法の選択」ボタンに表示されます（例：「Alipay/WeChat/Stripe/カスタム1」）。
- color: ボタン/バッジのテーマカラーまたはボーダーカラー。任意の CSS カラー値をサポートしていますが、既存のデザイン・トークン（例： `rgba(var(--semi-blue-5), 1)`）の使用を推奨します。
- type: チャネル識別子。バックエンドのルーティングと注文に使用されます。
  - `stripe` → Stripe ゲートウェイを経由します。
  - その他（例： `alipay`、`wxpay`、`custom1` など）→ 易支付スタイルのゲートウェイを経由し、この値をチャネルパラメータとして透過的に渡します。
  - 詳細なロジックはバックエンドコントローラ `controller/topup.go` を参照してください（参考: [controller/topup.go](https://github.com/QuantumNous/new-api/blob/main/controller/topup.go)）。
- min_topup: 最低チャージ金額（単位はページ上の通貨と一致）。入力金額がこの値より小さい場合、ページに「この支払い方法の最低チャージ金額は X です」と表示され、支払いの開始が制限されます。バックエンドでも検証が行われます。
- ソート: 配列の順序に従って左から右にレンダリングされます。

## チャージ金額の設定

### カスタムチャージ数量オプション

ユーザーが選択できるチャージ数量オプションを設定します。例：

```json
[10, 20, 50, 100, 200, 500]
```

これらの数値は「チャージ額の選択」エリアに表示され、ユーザーはクリックして対応するチャージ金額を直接選択できます。

### チャージ金額の割引設定

異なるチャージ金額に対応する割引を設定します。キーはチャージ金額、値は割引率です。例：

```json
{
  "100": 0.95,
  "200": 0.9,
  "500": 0.85
}
```

- キー：チャージ金額（文字列形式）
- 値：割引率（0～1の間の小数。例：0.95 は 95% の価格、つまり 5% 割引を意味します）
- システムは設定に基づいて、実際の支払い金額と節約金額を自動的に計算します。
- 詳細な実装ロジックはバックエンドコントローラ [controller/topup.go](https://github.com/QuantumNous/new-api/blob/main/controller/topup.go) を参照してください。